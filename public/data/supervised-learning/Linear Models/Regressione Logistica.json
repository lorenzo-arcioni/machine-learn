{
  "title": "Regressione Logistica",
  "content": "<style>pre { line-height: 125%; }\ntd.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }\nspan.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }\ntd.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }\nspan.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }\n.codehilite .hll { background-color: #ffffcc }\n.codehilite { background: #f8f8f8; }\n.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */\n.codehilite .err { border: 1px solid #F00 } /* Error */\n.codehilite .k { color: #008000; font-weight: bold } /* Keyword */\n.codehilite .o { color: #666 } /* Operator */\n.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */\n.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */\n.codehilite .cp { color: #9C6500 } /* Comment.Preproc */\n.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */\n.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */\n.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */\n.codehilite .gd { color: #A00000 } /* Generic.Deleted */\n.codehilite .ge { font-style: italic } /* Generic.Emph */\n.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */\n.codehilite .gr { color: #E40000 } /* Generic.Error */\n.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */\n.codehilite .gi { color: #008400 } /* Generic.Inserted */\n.codehilite .go { color: #717171 } /* Generic.Output */\n.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */\n.codehilite .gs { font-weight: bold } /* Generic.Strong */\n.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */\n.codehilite .gt { color: #04D } /* Generic.Traceback */\n.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */\n.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */\n.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */\n.codehilite .kp { color: #008000 } /* Keyword.Pseudo */\n.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */\n.codehilite .kt { color: #B00040 } /* Keyword.Type */\n.codehilite .m { color: #666 } /* Literal.Number */\n.codehilite .s { color: #BA2121 } /* Literal.String */\n.codehilite .na { color: #687822 } /* Name.Attribute */\n.codehilite .nb { color: #008000 } /* Name.Builtin */\n.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */\n.codehilite .no { color: #800 } /* Name.Constant */\n.codehilite .nd { color: #A2F } /* Name.Decorator */\n.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */\n.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */\n.codehilite .nf { color: #00F } /* Name.Function */\n.codehilite .nl { color: #767600 } /* Name.Label */\n.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */\n.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */\n.codehilite .nv { color: #19177C } /* Name.Variable */\n.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */\n.codehilite .w { color: #BBB } /* Text.Whitespace */\n.codehilite .mb { color: #666 } /* Literal.Number.Bin */\n.codehilite .mf { color: #666 } /* Literal.Number.Float */\n.codehilite .mh { color: #666 } /* Literal.Number.Hex */\n.codehilite .mi { color: #666 } /* Literal.Number.Integer */\n.codehilite .mo { color: #666 } /* Literal.Number.Oct */\n.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */\n.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */\n.codehilite .sc { color: #BA2121 } /* Literal.String.Char */\n.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */\n.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */\n.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */\n.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */\n.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */\n.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */\n.codehilite .sx { color: #008000 } /* Literal.String.Other */\n.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */\n.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */\n.codehilite .ss { color: #19177C } /* Literal.String.Symbol */\n.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */\n.codehilite .fm { color: #00F } /* Name.Function.Magic */\n.codehilite .vc { color: #19177C } /* Name.Variable.Class */\n.codehilite .vg { color: #19177C } /* Name.Variable.Global */\n.codehilite .vi { color: #19177C } /* Name.Variable.Instance */\n.codehilite .vm { color: #19177C } /* Name.Variable.Magic */\n.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */\n\n/* Styling per blocchi di codice */\n.codehilite {\n    background: transparent !important;\n    border-radius: 8px;\n    overflow: hidden;\n}\n.codehilite pre {\n    background: transparent !important;\n    margin: 0 !important;\n    padding: 20px !important;\n    font-family: 'Monaco', 'Menlo', 'Consolas', monospace !important;\n    font-size: 14px !important;\n    line-height: 1.5 !important;\n    white-space: pre !important;\n    overflow-x: auto !important;\n    color: inherit !important;\n}\n.codehilite code {\n    background: transparent !important;\n    padding: 0 !important;\n    font-family: inherit !important;\n}\n\n\n.code-wrapper { \n    position: relative; \n}\n.copy-button {\n    position: absolute; \n    top: 12px; \n    right: 12px; \n    padding: 6px 12px; \n    font-size: 12px;\n    cursor: pointer; \n    border: none; \n    border-radius: 4px; \n    background: rgba(255,255,255,0.9);\n    color: #374151; \n    transition: all 0.2s ease;\n    font-weight: 500;\n}\n.copy-button:hover { \n    background: rgba(255,255,255,1);\n    transform: translateY(-1px);\n}\n\n\ndetails.code-container {\n    border: 1px solid #e5e7eb; \n    border-radius: 12px; \n    background: #f9fafb;\n    margin: 16px 0;\n    transition: all 0.3s ease;\n}\ndetails.code-container summary {\n    padding: 12px 16px;\n    font-size: 14px; \n    color: #6b7280; \n    cursor: pointer; \n    outline: none; \n    user-select: none;\n    font-weight: 500;\n}\ndetails.code-container[open] summary::after { \n    content: \" (Hide Code)\"; \n    color: #9ca3af; \n}\ndetails.code-container:not([open]) summary::after { \n    content: \" (Show Code)\"; \n    color: #d1d5db; \n}\ndetails.code-container .code-wrapper {\n    padding: 0;\n    margin: 0;\n}\n</style>\n<p>La <strong>regressione logistica</strong> è un modello di classificazione che stima direttamente la probabilità di appartenenza a una classe, basandosi su un approccio <strong>discriminativo</strong>. Questo la differenzia da metodi <strong>generativi</strong> come l&rsquo;Analisi Discriminante Lineare (LDA), che modellano esplicitamente le distribuzioni delle features condizionate alle classi. Per una trattazione dettagliata del quadro probabilistico, consulta la <a href=\"/theory/introduction/Tipologie di Problemi/Classificazione Binaria\" class=\"text-blue-600 hover:underline\">Classificazione Binaria</a>.</p>\n<h2 id=\"fondamenti-probabilistici\"><strong>Fondamenti Probabilistici</strong></h2>\n<h3 id=\"collegamento-con-il-logit-e-la-sigmoide\">Collegamento con il Logit e la Sigmoide</h3>\n<p>Il <strong>logit</strong> rappresenta il <em>logaritmo del rapporto delle probabilità</em> (log-odds) tra classe positiva e negativa:\n$$\n\\text{logit}(p) = \\ln\\left(\\frac{p}{1-p}\\right) = \\mathbf x^\\top \\mathbf{w} +b\n$$</p>\n<details class=\"code-container\">\n<summary>Code</summary>\n<div class=\"code-wrapper\">\n<button class=\"copy-button\" onclick=\"\n                    const code = this.parentElement.querySelector('pre');\n                    if (code) {\n                        navigator.clipboard.writeText(code.innerText);\n                        this.textContent = 'Copied!';\n                        setTimeout(() => this.textContent = 'Copy', 2000);\n                    }\n                \">Copy</button>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">numpy</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">np</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">matplotlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">rcParams</span>\n\n<span class=\"c1\"># Configurazione stile avanzato</span>\n<span class=\"n\">rcParams</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span>\n    <span class=\"s1\">&#39;font.family&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;serif&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;mathtext.fontset&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;cm&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.facecolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;white&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.edgecolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.grid&#39;</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;grid.color&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;0.85&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.labelcolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;xtick.color&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;0.4&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;ytick.color&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;0.4&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.titlepad&#39;</span><span class=\"p\">:</span> <span class=\"mi\">15</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.titlesize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">14</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.labelsize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">12</span><span class=\"p\">,</span>\n<span class=\"p\">})</span>\n\n<span class=\"c1\"># Definizione delle funzioni</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"mi\">1</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">+</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">exp</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">x</span><span class=\"p\">))</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">logit</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">p</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">p</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># Generazione dati</span>\n<span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">500</span><span class=\"p\">)</span>\n<span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"mf\">0.01</span><span class=\"p\">,</span> <span class=\"mf\">0.99</span><span class=\"p\">,</span> <span class=\"mi\">100</span><span class=\"p\">)</span>\n<span class=\"n\">log_odds</span> <span class=\"o\">=</span> <span class=\"n\">logit</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Creazione figura con griglia personalizzata</span>\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">),</span> <span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">gs</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_gridspec</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">width_ratios</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mf\">1.2</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># Plot Sigmoide e Logit (trasformazione inversa)</span>\n<span class=\"n\">ax1</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#1f77b4&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span> \n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma(x) = \\frac{1}{1+e^{-x}}$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Sigmoide: Da Logit a Probabilità&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$x = \\mathbf{w}^\\top \\mathbf{x} + b$ (logit)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma(x)$ (probabilità)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;upper left&#39;</span><span class=\"p\">,</span> <span class=\"n\">frameon</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Aggiunta annotazioni matematiche</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma(0) = 0.5$&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mf\">0.5</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mf\">0.4</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\lim_{x \\to +\\infty} \\sigma(x) = 1$&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mf\">0.98</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mf\">0.8</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\lim_{x \\to -\\infty} \\sigma(x) = 0$&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mf\">0.02</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mf\">0.2</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># Plot Log-Odds (Funzione Logit)</span>\n<span class=\"n\">ax2</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span> <span class=\"n\">log_odds</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#d62728&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span> \n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\mathrm{logit}(p) = \\ln\\left(\\frac{p}{1-p}\\right)$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Funzione Logit: Da Probabilità a Log-Odds&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$p$ (probabilità)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\mathrm{logit}(p)$ (log-odds)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;upper left&#39;</span><span class=\"p\">,</span> <span class=\"n\">frameon</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Linee guida e annotazioni</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">axhline</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.5&#39;</span><span class=\"p\">,</span> <span class=\"n\">linestyle</span><span class=\"o\">=</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">axvline</span><span class=\"p\">(</span><span class=\"mf\">0.5</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.5&#39;</span><span class=\"p\">,</span> <span class=\"n\">linestyle</span><span class=\"o\">=</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\mathrm{logit}(0.5) = 0$&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.5</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.6</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\lim_{p \\to 1^-} \\mathrm{logit}(p) = +\\infty$&#39;</span><span class=\"p\">,</span> \n             <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.95</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.7</span><span class=\"p\">,</span> <span class=\"mf\">2.5</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\lim_{p \\to 0^+} \\mathrm{logit}(p) = -\\infty$&#39;</span><span class=\"p\">,</span> \n             <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.05</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">3</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">2.5</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">arrowstyle</span><span class=\"o\">=</span><span class=\"s2\">&quot;-&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;0.3&#39;</span><span class=\"p\">))</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;logit_sigmoid_dual.pdf&#39;</span><span class=\"p\">,</span> <span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"n\">bbox_inches</span><span class=\"o\">=</span><span class=\"s1\">&#39;tight&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span>\n</code></pre></div>\n</div>\n</details>\n\n<p><img src=\"/images/posts/logit.jpg\" alt=\"Logit\"></p>\n<p><em>Figura 1.0: Funzione logit. Relazione Duale: $\\sigma(\\mathrm{logit}(p)) = p$ e $\\mathrm{logit}(\\sigma(x)) = x$</em></p>\n<p>La <strong>funzione sigmoide</strong> $\\sigma(\\cdot)$ ne è l&rsquo;inversa:\n$$\np = \\sigma(\\mathbf x^\\top \\mathbf{w} + b) = \\frac{1}{1 + e^{-(\\mathbf x^\\top \\mathbf{w} + b)}}\n$$</p>\n<p><img alt=\"Funzione sigmoide\" src=\"/images/tikz/Logistic-curve.svg\" /></p>\n<p><em>Figura 2.1: Funzione sigmoide.</em></p>\n<p>Questa relazione deriva direttamente dalla massimizzazione della <em>verosimiglianza</em> (MLE) sotto un modello lineare generalizzato (GLM). Per i dettagli analitici, vedi la <a href=\"/theory/introduction/Tipologie di Problemi/Classificazione Binaria\" class=\"text-blue-600 hover:underline\">Classificazione Binaria</a>.</p>\n<h2 id=\"definizioni-generali\"><strong>Definizioni Generali</strong></h2>\n<p>Dato un dataset $\\mathcal D = \\{(\\mathbf x_i, y_i)\\}_{i=1}^n$, una regressione logistica classifica le osservazioni in due classi: $y_i \\in \\{0, 1\\}$. La funzione stimata $\\hat{f}_\\mathbf w$ utilizza la funzione sigmoide per mappare i vettori $\\mathbf x_i \\in \\mathbb R^{(m+1)}$ in probabilità tramite un vettore di pesi $\\mathbf w \\in \\mathbb R^{m+1}$. Per semplicità, assumeremo che i vettori siano:</p>\n$$\n\\mathbf w = \\begin{bmatrix} w_0 \\\\ \\vdots \\\\ w_m \\end{bmatrix} \\quad \\text{e} \\quad \\mathbf x = \\begin{bmatrix} x_0 = 1 \\\\ x_1 \\\\ \\vdots \\\\ x_m \\end{bmatrix}.\n$$\n<p>Quindi:</p>\n$$\n\\hat{f}_\\mathbf w(\\mathbf x_i) = \\sigma(\\mathbf x^\\top \\mathbf{w}) = \\frac{1}{1 + e^{-(\\mathbf x^\\top \\mathbf{w})}}.\n$$\n<p>In questo modo la funzione stimata diventa:</p>\n$$\n\\hat{f}_\\mathbf w(\\mathbf x_i) = \\sigma(\\mathbf{x}_i^\\top \\mathbf w) = \\frac{1}{1 + e^{-\\mathbf{x}_i^\\top \\mathbf w}}\n$$\n<p>Quindi:\n- $p(y_i=1 \\mid \\mathbf x_i, \\mathbf w) = \\sigma(\\mathbf{x}_i^\\top \\mathbf w) = \\frac{1}{1 + e^{-\\mathbf{x}_i^\\top \\mathbf w}}$\n- $p(y_i=0 \\mid \\mathbf x_i, \\mathbf w) = 1 - \\sigma(\\mathbf{x}_i^\\top \\mathbf w) = \\frac{e^{-\\mathbf{x}_i^\\top \\mathbf w}}{1 + e^{-\\mathbf{x}_i^\\top \\mathbf w}}$</p>\n<p>Quindi, la verosimiglianza del vettore di tutte le osservazioni $\\mathbf y \\in \\mathbb R^n$ dati un vettore di pesi $\\mathbf w \\in \\mathbb R^{m+1}$ e una matrice di features $\\mathbf X \\in \\mathbb R^{n \\times (m+1)}$ viene definita come:</p>\n$$\\begin{align*}\np(\\mathbf y \\mid \\mathbf X, \\mathbf w) &= \\prod_{i=1}^n \\hat{f}_\\mathbf w(\\mathbf x_i)^{y_i} \\left(1 - \\hat{f}_\\mathbf w(\\mathbf x_i)\\right)^{1 - y_i}\\\\ \n&=\\prod_{i=1}^n \\sigma(\\mathbf{x}_i^\\top \\mathbf w)^{y_i} \\left(1 - \\sigma(\\mathbf{x}_i^\\top \\mathbf w)\\right)^{1 - y_i}.\n\\end{align*}\n$$\n<p>In questo modo, quando (la label del dataset) $y_i = 1$, consideriamo la probabilità predetta dal modello per la classe $1$, mentre quando $y_i = 0$, consideriamo la probabilità predetta dal modello per la classe $0$.</p>\n<p>Il nostro obiettivo è quello di trovare il vettore di pesi $\\mathbf w$ che massimizza questa funzione di verosimiglianza (la probabilità che, dati i dati e i pesi, si ottengano le previsioni giuste).</p>\n<h2 id=\"ottimizzazione-del-modello\"><strong>Ottimizzazione del Modello</strong></h2>\n<p>Ora possiamo quindi definire la funzione di verosimiglianza (Likelihood Function) come:</p>\n$$\n\\mathcal{L}(\\mathbf{w}) = \\prod_{i=1}^n p(y_i \\mid \\mathbf x_i, \\mathbf w) = \\prod_{i=1}^n \\sigma(\\mathbf{x}_i^\\top \\mathbf w)^{y_i} \\left(1 - \\sigma(\\mathbf{x}_i^\\top \\mathbf w)\\right)^{1 - y_i}.\n$$\n<p>Chiaramente, questa funzione non è lineare ne tanto meno convessa (grazie alla funzione sigmoide), quindi non possiamo sfruttare le care tecniche di ottimizzazione convessa (ponendo il gradinete $=0$ e risolvendo per $\\mathbf w$); non otteniamo la soluzione ottima. Questo può essere un problema non da poco, ma che risolveremo di seguito.</p>\n<h3 id=\"funzione-di-perdita-log-loss\">Funzione di Perdita (Log-Loss)</h3>\n<p>Applicando il logaritmo ad entrambi i membri della funzione di verosimiglianza otteniamo: </p>\n$$\n\\ln \\mathcal{L}(\\mathbf{w}) = \\sum_{i=1}^n \\left(y_i \\ln(\\sigma(\\mathbf{x}_i^\\top \\mathbf w)) + (1 - y_i) \\ln(1 - \\sigma(\\mathbf{x}_i^\\top \\mathbf w))\\right).\n$$\n<p>In questo modo, dato che il logaritmo è una funzione monotona crescente, non modifichiamo il problema di massimizzazione della funzione di verosimiglianza.</p>\n<p>In più, applicando un coefficiente (negativo) di mediazione $-\\frac{1}{n}$, otteniamo una nuova funzione di perdita $\\mathcal{LL}(\\mathbf w)$ detta <strong>Log-Loss</strong> o <strong>Cross-Entropy</strong> o <strong>Logarithmic Loss</strong>:</p>\n$$\n\\mathcal{LL}(\\mathbf{w}) = -\\frac{1}{n} \\sum_{i=1}^n \\left(y_i \\ln(\\sigma(\\mathbf{x}_i^\\top \\mathbf w)) + (1 - y_i) \\ln(1 - \\sigma(\\mathbf{x}_i^\\top \\mathbf w))\\right).\n$$\n<p>Quindi il problema di massimizzazione della funzione di verosimiglianza diventa un problema di minimizzazione della funzione di perdita (grazie al fattore di mediazione negativo). Inoltre, la nuova funzione $\\mathcal{LL}(\\mathbf{w})$ è una funzione convessa. 😃</p>\n<details class=\"code-container\">\n<summary>Code</summary>\n<div class=\"code-wrapper\">\n<button class=\"copy-button\" onclick=\"\n                    const code = this.parentElement.querySelector('pre');\n                    if (code) {\n                        navigator.clipboard.writeText(code.innerText);\n                        this.textContent = 'Copied!';\n                        setTimeout(() => this.textContent = 'Copy', 2000);\n                    }\n                \">Copy</button>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">numpy</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">np</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">matplotlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">rcParams</span>\n\n<span class=\"c1\"># Configurazione stile globale</span>\n<span class=\"n\">rcParams</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span>\n    <span class=\"s1\">&#39;font.family&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;serif&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;font.size&#39;</span><span class=\"p\">:</span> <span class=\"mi\">12</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.titlesize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">14</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.labelsize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">12</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;xtick.labelsize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;ytick.labelsize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.grid&#39;</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;grid.alpha&#39;</span><span class=\"p\">:</span> <span class=\"mf\">0.3</span>\n<span class=\"p\">})</span>\n\n<span class=\"c1\"># Definizione delle funzioni</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"mi\">1</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">+</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">exp</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">x</span><span class=\"p\">))</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">log_sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">log1p</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">exp</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">x</span><span class=\"p\">))</span>  <span class=\"c1\"># Forma numericamente stabile</span>\n\n<span class=\"c1\"># Calcolo analitico delle derivate seconde</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">sigmoid_second_deriv</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"n\">σ</span> <span class=\"o\">=</span> <span class=\"n\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">σ</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">σ</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">σ</span><span class=\"p\">)</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">log_sigmoid_second_deriv</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"n\">σ</span> <span class=\"o\">=</span> <span class=\"n\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"n\">σ</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">σ</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Generazione dati</span>\n<span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">500</span><span class=\"p\">)</span>\n<span class=\"n\">σ</span> <span class=\"o\">=</span> <span class=\"n\">sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n<span class=\"n\">log_σ</span> <span class=\"o\">=</span> <span class=\"n\">log_sigmoid</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n<span class=\"n\">σ_deriv2</span> <span class=\"o\">=</span> <span class=\"n\">sigmoid_second_deriv</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n<span class=\"n\">log_σ_deriv2</span> <span class=\"o\">=</span> <span class=\"n\">log_sigmoid_second_deriv</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Creazione figura con griglia personalizzata</span>\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">14</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">gs</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_gridspec</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">hspace</span><span class=\"o\">=</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"n\">wspace</span><span class=\"o\">=</span><span class=\"mf\">0.2</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Plot sigmoide</span>\n<span class=\"n\">ax1</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">])</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">σ</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#1f77b4&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mf\">2.5</span><span class=\"p\">,</span> \n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma(x) = \\frac{1}{1+e^{-x}}$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Funzione Sigmoide&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;x&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma(x)$&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower right&#39;</span><span class=\"p\">,</span> <span class=\"n\">framealpha</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax1</span><span class=\"o\">.</span><span class=\"n\">set_ylim</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.1</span><span class=\"p\">,</span> <span class=\"mf\">1.1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Plot derivata seconda sigmoide</span>\n<span class=\"n\">ax2</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">])</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">σ_deriv2</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#d62728&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mf\">2.5</span><span class=\"p\">,</span>\n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma^{\\prime\\prime}(x) = \\sigma(x)(1-\\sigma(x))(1-2\\sigma(x))$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">axhline</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;black&#39;</span><span class=\"p\">,</span> <span class=\"n\">linestyle</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Derivata Seconda della Sigmoide&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;x&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\sigma^{\\prime\\prime}(x)$&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower left&#39;</span><span class=\"p\">,</span> <span class=\"n\">framealpha</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s1\">&#39;Convessa (σ</span><span class=\"se\">\\&#39;\\&#39;</span><span class=\"s1\">&gt;0)&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mf\">0.15</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mf\">0.2</span><span class=\"p\">),</span>\n             <span class=\"n\">arrowprops</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;black&#39;</span><span class=\"p\">,</span> <span class=\"n\">shrink</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">))</span>\n<span class=\"n\">ax2</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s1\">&#39;Concava (σ</span><span class=\"se\">\\&#39;\\&#39;</span><span class=\"s1\">&lt;0)&#39;</span><span class=\"p\">,</span> <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.2</span><span class=\"p\">),)</span>\n\n<span class=\"c1\"># Plot log-sigmoide</span>\n<span class=\"n\">ax3</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">])</span>\n<span class=\"n\">ax3</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">log_σ</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#2ca02c&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mf\">2.5</span><span class=\"p\">,</span>\n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\log\\sigma(x) = -\\log(1+e^{-x})$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax3</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Logaritmo della Sigmoide&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"n\">ax3</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;x&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax3</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$\\log\\sigma(x)$&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax3</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower right&#39;</span><span class=\"p\">,</span> <span class=\"n\">framealpha</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Plot derivata seconda log-sigmoide</span>\n<span class=\"n\">ax4</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"n\">gs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">])</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">log_σ_deriv2</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#ff7f0e&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mf\">2.5</span><span class=\"p\">,</span>\n         <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$(\\log\\sigma(x))^{\\prime\\prime} = -\\sigma(x)(1-\\sigma(x))$&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">axhline</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;black&#39;</span><span class=\"p\">,</span> <span class=\"n\">linestyle</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span> <span class=\"n\">linewidth</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Derivata Seconda del Log-Sigmoide&#39;</span><span class=\"p\">,</span> <span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;x&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s1\">&#39;$(\\log\\sigma(x))^{\\prime\\prime}$&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;upper center&#39;</span><span class=\"p\">,</span> <span class=\"n\">framealpha</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax4</span><span class=\"o\">.</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s1\">&#39;Sempre concava</span><span class=\"se\">\\n</span><span class=\"s1\">(derivata seconda &lt;0)&#39;</span><span class=\"p\">,</span> \n             <span class=\"n\">xy</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1</span><span class=\"p\">),</span> <span class=\"n\">xytext</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.22</span><span class=\"p\">))</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;./images/log-sigmoid-convex.jpg&#39;</span><span class=\"p\">,</span> \n           <span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"mi\">250</span><span class=\"p\">,</span> \n           <span class=\"n\">bbox_inches</span><span class=\"o\">=</span><span class=\"s1\">&#39;tight&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">pad_inches</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">,</span>  <span class=\"c1\"># Aggiungere questo parametro</span>\n           <span class=\"c1\">#facecolor=fig.get_facecolor(),  # Mantenere il colore di sfondo</span>\n           <span class=\"n\">transparent</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>  <span class=\"c1\"># Disabilitare la trasparenza</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span>\n</code></pre></div>\n</div>\n</details>\n\n<p><img title=\"a title\" alt=\"Alt text\" src=\"/images/posts/log-sigmoid-convex.jpg\"></p>\n<p><em>Figura 2.0: Convessità del logaritmo della sigmoide</em></p>\n<p>Infatti, possiamo notare che la funzione $-\\ln(\\sigma(x))$ (e quindi anche $\\ln(1-\\sigma(x))$) è convessa, in quanto la sua derivata seconda è sempre negativa.</p>\n<p><strong>Proof:</strong> </p>\n$$\n\\begin{align*}\nf(x) &= -\\ln(\\sigma(x)) \\quad \\text{dove} \\quad \\sigma(x) = \\frac{1}{1 + e^{-x}}\\\\\nf(x) &= -\\ln\\left(\\frac{1}{1 + e^{-x}}\\right) = \\ln(1 + e^{-x})\\\\\nf'(x) &= \\frac{d}{dx} \\ln(1 + e^{-x}) = \\frac{-e^{-x}}{1 + e^{-x}} = -\\frac{1}{1 + e^{x}}\\\\\nf''(x) &= \\frac{d}{dx} \\left(-\\frac{1}{1 + e^{x}}\\right) = \\frac{e^{x}}{(1 + e^{x})^2}\n\\end{align*}\n$$\n<p>La funzione è <strong>convessa</strong> se $f''(x) \\geq 0$ per ogni $x \\in \\mathbb{R}$.<br />\nOsserviamo che:\n- $e^{x} > 0$ per ogni $x$\n- $(1 + e^{x})^2 > 0$ per ogni $x$</p>\n<p>Quindi:\n$$\nf''(x) = \\underbrace{\\frac{e^{x}}{(1 + e^{x})^2}}_{\\text{Sempre positivo}} > 0 \\quad \\forall x\n$$</p>\n<p><strong>Conclusione</strong>:<br />\n- $\\ln(\\sigma(x))$ è <strong>strettamente convessa</strong> su tutto $\\mathbb{R}$. $\\square$</p>\n<h3 id=\"dimostrazione-della-convessita-della-log-loss\">Dimostrazione della Convessità della Log-Loss</h3>\n<p>Per dimostrare che la <strong>log-loss</strong> è una funzione convessa, possiamo verificare che la sua Hessiana (la matrice delle derivate seconde) è <strong>definita positiva</strong>. Seguiamo i passaggi dettagliatamente.</p>\n<h4 id=\"1-definizione-della-log-loss\">1. Definizione della Log-Loss</h4>\n<p>Supponiamo di avere la funzione di log-loss:</p>\n$$\n\\mathcal{LL}(\\mathbf w) = -\\frac{1}{n} \\sum_{i=1}^{n} \\left[ y_i \\ln(\\sigma(z_i)) + (1 - y_i) \\ln(1 - \\sigma(z_i)) \\right],\n$$\n<p>dove:</p>\n<ul>\n<li>$z_i = \\mathbf x_i^\\top \\mathbf w$ rappresenta la combinazione lineare dei pesi $\\mathbf w$ e delle feature $\\mathbf x_i$.</li>\n<li>$\\sigma(z)$ è la <strong>funzione sigmoide</strong> definita come:</li>\n</ul>\n$$\n  \\sigma(z) = \\frac{1}{1 + e^{- z}}.\n  $$\n<h4 id=\"2-calcolo-della-derivata-prima\">2. Calcolo della derivata prima</h4>\n<p>Consideriamo la funzione interna:</p>\n$$\nf(z_i) = -\\left[ y_i \\ln(\\sigma(z_i)) + (1 - y_i) \\ln(1 - \\sigma(z_i)) \\right].\n$$\n<p>Deriviamo rispetto a $z_i$. Utilizzando le proprietà della funzione sigmoide, otteniamo:</p>\n$$\n\\frac{d}{dz_i} f(z_i) = \\sigma(z_i) - y_i.\n$$\n<p>Derivando poi $z_i$ rispetto ai pesi $\\mathbf w$, otteniamo:</p>\n$$\n\\frac{d z_i}{d\\mathbf w} = \\mathbf x_i.\n$$\n<p>Applicando la <strong>chain rule</strong>, la derivata della log-loss rispetto ai pesi $\\mathbf w$ è:</p>\n$$\n\\nabla_{\\mathbf w} \\mathcal{LL}(\\mathbf w) = \\frac{1}{n} \\sum_{i=1}^{n} \\frac{d f(z_i)}{dz_i}\\frac{d z_i}{d\\mathbf w} = \\frac{1}{n} \\sum_{i=1}^{n} (\\sigma(z_i) - y_i) \\mathbf x_i.\n$$\n<p>Questa espressione rappresenta il <strong>gradiente</strong> della log-loss.</p>\n<h4 id=\"3-calcolo-della-hessiana-derivata-seconda\">3. Calcolo della Hessiana (derivata seconda)</h4>\n<p>Per avere la garanzia che la funzione di log-loss sia <strong>convessa</strong>, bisogna verificare che la sua Hessiana (la matrice delle derivate seconde) sia <strong>semidefinita positiva</strong>, il che garantisce che la funzione <strong>abbia curvatura non negativa in tutte le direzioni</strong> e quindi che sia convessa.</p>\n<p>Per calcolare la <strong>matrice Hessiana</strong> della log-loss, deriviamo il gradiente $\\nabla_{\\mathbf{w}} \\mathcal{LL}(\\mathbf{w})$ rispetto a $\\mathbf{w}$.<br />\nSappiamo che:\n$$\n\\nabla_{\\mathbf{w}} \\mathcal{LL}(\\mathbf{w}) = \\frac{1}{n} \\sum_{i=1}^n (\\sigma(z_i) - y_i) \\mathbf{x}_i\n$$</p>\n<p><strong>Passaggio 3.1: Derivata del gradiente</strong><br />\nDeriviamo ogni componente $j$-esima del gradiente rispetto a $w_k$:\n$$\n\\frac{\\partial}{\\partial w_k} \\left[ \\frac{1}{n} \\sum_{i=1}^n (\\sigma(z_i) - y_i) x_{ij} \\right] = \\frac{1}{n} \\sum_{i=1}^n \\frac{\\partial \\sigma(z_i)}{\\partial w_k} x_{ij} - \\underbrace{\\frac{\\partial y_i x_{ij}}{\\partial w_k}}_{= 0} = \\frac{1}{n} \\sum_{i=1}^n \\frac{\\partial \\sigma(z_i)}{\\partial w_k} x_{ij}\n$$</p>\n<p><strong>Passaggio 3.2: Derivata della sigmoide</strong><br />\nUsiamo la proprietà $\\sigma'(z_i) = \\sigma(z_i)(1 - \\sigma(z_i))$:\n$$\n\\frac{\\partial \\sigma(z_i)}{\\partial w_k} = \\sigma(z_i)(1 - \\sigma(z_i)) \\cdot \\frac{\\partial z_i}{\\partial w_k} = \\sigma(z_i)(1 - \\sigma(z_i)) x_{ik}\n$$</p>\n<p><strong>Passaggio 3.3: Forma matriciale della Hessiana</strong><br />\nSostituendo nella derivata seconda:</p>\n$$\n\\nabla_{\\mathbf{w}}^2 \\mathcal{LL}(\\mathbf{w}) = \\frac{\\partial}{\\partial \\mathbf{w}} \\left( \\nabla_{\\mathbf{w}} \\mathcal{LL}(\\mathbf{w}) \\right) = \\frac{1}{n} \\sum_{i=1}^n \\frac{\\partial}{\\partial \\mathbf{w}} \\left[ (\\sigma(z_i) - y_i) \\mathbf{x}_i \\right] = \\frac{1}{n} \\sum_{i=1}^n \\sigma(z_i)(1 - \\sigma(z_i)) \\mathbf{x}_i \\mathbf{x}_i^\\top\n$$\n<p>dove:</p>\n$$\n\\frac{\\partial}{\\partial w_k} \\left[ (\\sigma(z_i) - y_i) x_{ij} \\right] = \\underbrace{\\frac{\\partial \\sigma(z_i)}{\\partial w_k}}_{\\sigma(z_i)(1 - \\sigma(z_i)) x_{ik}} \\cdot x_{ij} = \\sigma(z_i)(1 - \\sigma(z_i)) x_{ik} x_{ij}\n$$\n<p>che quindi equivale a </p>\n$$\n\\mathbf{H}_i = \\sigma(z_i)(1 - \\sigma(z_i)) \n\\begin{bmatrix}\nx_{i1}x_{i1} & x_{i1}x_{i2} & \\cdots & x_{i1}x_{id} \\\\\nx_{i2}x_{i1} & x_{i2}x_{i2} & \\cdots & x_{i2}x_{id} \\\\\n\\vdots & \\vdots & \\ddots & \\vdots \\\\\nx_{id}x_{i1} & x_{id}x_{i2} & \\cdots & x_{id}x_{id}\n\\end{bmatrix}\n= \\sigma(z_i)(1 - \\sigma(z_i)) \\, \\mathbf{x}_i \\mathbf{x}_i^\\top\n$$\n<h4 id=\"4-analisi-della-definita-positivita\">4. Analisi della Definita Positività</h4>\n<p>Ora abbiamo:</p>\n<ul>\n<li>\n<p><strong>1. Positività dei coefficienti</strong>: $\\sigma(z_i)(1 - \\sigma(z_i)) > 0 \\quad \\forall z_i \\in \\mathbb{R}$, poiché $\\sigma(z_i) \\in (0,1)$.</p>\n</li>\n<li>\n<p><strong>2. Matrici semidefinite positive</strong>: Ogni matrice $\\mathbf{x}_i \\mathbf{x}_i^\\top$ è <span class=\"text-gray-600\">semidefinita positiva</span>. </p>\n<p>Per ogni vettore $\\mathbf{v} \\in \\mathbb{R}^d$:\n$$\n    \\mathbf{v}^\\top (\\mathbf{x}_i \\mathbf{x}_i^\\top) \\mathbf{v} = (\\mathbf{x}_i^\\top \\mathbf{v})^2 \\geq 0\n    $$</p>\n<p>Dimostriamo ora che per ogni vettore $\\mathbf{x}_i \\in \\mathbb{R}^d$, la matrice $\\mathbf{x}_i \\mathbf{x}_i^\\top$ è semidefinita positiva.</p>\n<p>Una matrice $M \\in \\mathbb{R}^{d \\times d}$ è semidefinita positiva (PSD) se e solo se:<br />\n$$\n    \\forall \\mathbf{v} \\in \\mathbb{R}^d \\setminus \\{\\mathbf{0}\\}, \\quad \\mathbf{v}^\\top M \\mathbf{v} \\geq 0\n    $$</p>\n<p>Sia $\\mathbf{v} \\in \\mathbb{R}^d$ un vettore non nullo arbitrario. Calcoliamo:\n$$\n    \\mathbf{v}^\\top (\\mathbf{x}_i \\mathbf{x}_i^\\top) \\mathbf{v} = (\\mathbf{v}^\\top \\mathbf{x}_i)(\\mathbf{x}_i^\\top \\mathbf{v})\n    $$<br />\nPoiché $\\mathbf{v}^\\top \\mathbf{x}_i$ è uno scalare, vale:<br />\n$$\n    (\\mathbf{v}^\\top \\mathbf{x}_i)(\\mathbf{x}_i^\\top \\mathbf{v}) = (\\mathbf{x}_i^\\top \\mathbf{v})^\\top (\\mathbf{x}_i^\\top \\mathbf{v}) = \\|\\mathbf{x}_i^\\top \\mathbf{v}\\|^2\n    $$</p>\n<p>Per qualsiasi scalare $a \\in \\mathbb{R}$, si ha $a^2 \\geq 0$. Quindi:<br />\n$$\n    \\|\\mathbf{x}_i^\\top \\mathbf{v}\\|^2 \\geq 0 \\quad \\forall \\mathbf{v} \\neq \\mathbf{0}\n    $$</p>\n<p>Poiché $\\mathbf{v}^\\top (\\mathbf{x}_i \\mathbf{x}_i^\\top) \\mathbf{v} \\geq 0$ per ogni $\\mathbf{v} \\neq \\mathbf{0}$, la matrice $\\mathbf{x}_i \\mathbf{x}_i^\\top$ è semidefinita positiva per definizione. $\\square$</p>\n</li>\n</ul>\n<p><strong>Corollari</strong>:\n- <strong>Autovalori Non Negativi</strong>: Gli autovalori di $\\mathbf{x}_i \\mathbf{x}_i^\\top$ sono $\\|\\mathbf{x}_i\\|^2$ (autovalore non negativo) e $0$ (con molteplicità $d-1$).\n- <strong>Rank 1</strong>: Se $\\mathbf{x}_i \\neq \\mathbf{0}$, la matrice ha rank 1, con autovettore $\\mathbf{x}_i$.</p>\n<p>La combinazione lineare:<br />\n$$\n\\sum_{i=1}^n \\sigma(z_i)(1 - \\sigma(z_i)) \\mathbf{x}_i \\mathbf{x}_i^\\top\n$$<br />\nmantiene la positività semidefinita perché:\n  1. Coefficienti $\\sigma(z_i)(1 - \\sigma(z_i)) > 0$\n  2. Somma di matrici PSD pesate positivamente è PSD\n  3. Somma di matrici PSD pesate negativamente non sono PSD</p>\n<p>Quindi, la Hessiana $\\mathbf{H}_i$ per ogni osservazione $i$ risulta essere <strong>semidefinita positiva</strong>.</p>\n<h4 id=\"5-conclusione-finale\">5. Conclusione Finale</h4>\n<p>Poiché la Hessiana è semidefinita positiva per ogni $\\mathbf{w}$, la funzione di log-loss $\\mathcal{LL}(\\mathbf{w})$ è <strong>convessa</strong> su $\\mathbb{R}^d$. $\\square$</p>\n<p>Tuttavia, se imponessimo ora $\\nabla_{\\mathbf{w}} \\mathcal{LL}(\\mathbf{w}) = 0$, otterremmo il <strong>minimo globale</strong> della funzione di log-loss $\\mathcal{LL}(\\mathbf{w})$. Se non fosse che questa equazione è un&rsquo;equazione trascendente, e può essere dimostrato che queste tipologie di equazioni non hanno una soluzione analitica. Quindi, per ottenere il minimo globale, bisogna utilizzare un metodo numerico di ottimizzazione. </p>\n<p>L’ottimizzazione tramite <a href=\"/theory/math-for-ml/Ottimizzazione/Non-Lineare/Discesa del Gradiente\" class=\"text-blue-600 hover:underline\">discesa del gradiente</a> è una delle soluzioni più comuni, e grazie alla convessità della funzione di log-loss, può convergere a un <strong>unico minimo globale</strong> (se esiste).</p>\n<p><strong>Implicazioni pratiche</strong>:<br />\n- L’assenza di minimi locali rende la regressione logistica <strong>stabile</strong> e <strong>prevedibile</strong> nell’ottimizzazione.<br />\n- Metodi del secondo ordine (es. Newton-Raphson) sfruttano direttamente la convessità per convergenza rapida.</p>\n<h2 id=\"estensione-multiclasse-softmax-e-logica-multinomiale\"><strong>Estensione Multiclasse: Softmax e Logica Multinomiale</strong></h2>\n<p>La regressione logistica può essere estesa a problemi di classificazione con $K \\geq 2$ classi tramite il modello <strong>Softmax</strong> (o <strong>regressione multinomiale</strong>). Questo approccio generalizza la funzione sigmoide per gestire più classi, preservando la convessità della funzione di perdita.</p>\n<h3 id=\"fondamenti-probabilistici_1\"><strong>Fondamenti Probabilistici</strong></h3>\n<h4 id=\"1-funzione-softmax\">1. Funzione Softmax</h4>\n<p>Dato un vettore di punteggi (logit) $\\mathbf{z} = [z_1, \\dots, z_K]^\\top$, dove $z_k = \\mathbf{x}^\\top \\mathbf{w}_k$, la funzione softmax mappa i logit in probabilità:\n$$\n\\sigma(\\mathbf{z})_k = \\frac{e^{z_k}}{\\sum_{j=1}^K e^{z_j}}, \\quad k = 1, \\dots, K\n$$\n- <strong>Proprietà</strong>:\n  - $\\sigma(\\mathbf{z})_k \\in (0,1)$\n  - $\\sum_{k=1}^K \\sigma(\\mathbf{z})_k = 1$</p>\n<h4 id=\"2-modello-probabilistico\">2. Modello Probabilistico</h4>\n<p>Per un&rsquo;osservazione $\\mathbf{x}$, la probabilità di appartenere alla classe $k$ è:\n$$\np(y=k \\mid \\mathbf{x}, \\mathbf{W}) = \\sigma(\\mathbf{z})_k = \\frac{e^{\\mathbf{x}^\\top \\mathbf{w}_k}}{\\sum_{j=1}^K e^{\\mathbf{x}^\\top \\mathbf{w}_j}}\n$$\ndove $\\mathbf{W} = [\\mathbf{w}_1, \\dots, \\mathbf{w}_K] \\in \\mathbb{R}^{(m+1) \\times K}$ è la matrice dei pesi.</p>\n<h3 id=\"funzione-di-perdita-cross-entropy-multiclasse\"><strong>Funzione di Perdita (Cross-Entropy Multiclasse)</strong></h3>\n<h4 id=\"3-log-verosimiglianza\">3. Log-Verosimiglianza</h4>\n<p>Data una matrice di labels $\\mathbf{Y} \\in \\{0,1\\}^{n \\times K}$ (one-hot encoded), la log-verosimiglianza è:\n$$\n\\ln \\mathcal{L}(\\mathbf{W}) = \\sum_{i=1}^n \\sum_{k=1}^K y_{ik} \\ln\\left( \\frac{e^{\\mathbf{x}_i^\\top \\mathbf{w}_k}}{\\sum_{j=1}^K e^{\\mathbf{x}_i^\\top \\mathbf{w}_j}} \\right)\n$$</p>\n<h4 id=\"4-cross-entropy-loss\">4. Cross-Entropy Loss</h4>\n<p>La funzione di perdita (negativa log-verosimiglianza normalizzata) è:\n$$\n\\mathcal{LL}(\\mathbf{W}) = -\\frac{1}{n} \\sum_{i=1}^n \\sum_{k=1}^K y_{ik} \\ln\\left( \\sigma(\\mathbf{z}_i)_k \\right)\n$$</p>\n<h3 id=\"ottimizzazione-del-modello_1\"><strong>Ottimizzazione del Modello</strong></h3>\n<h4 id=\"5-gradiente\">5. Gradiente</h4>\n<p>Il gradiente rispetto a $\\mathbf{w}_k$ è:\n$$\n\\nabla_{\\mathbf{w}_k} \\mathcal{LL}(\\mathbf{W}) = -\\frac{1}{n} \\sum_{i=1}^n \\mathbf{x}_i \\left( y_{ik} - \\sigma(\\mathbf{z}_i)_k \\right)\n$$\n<strong>Dimostrazione</strong>:\n- Sia $p_{ik} = \\sigma(\\mathbf{z}_i)_k$\n- Derivando $\\mathcal{LL}$ rispetto a $\\mathbf{w}_k$:\n  $$\n  \\frac{\\partial \\mathcal{LL}}{\\partial \\mathbf{w}_k} = -\\frac{1}{n} \\sum_{i=1}^n \\mathbf{x}_i \\left( y_{ik} - p_{ik} \\right)\n  $$</p>\n<h4 id=\"6-hessiana\">6. Hessiana</h4>\n<p>La matrice Hessiana è <strong>blocco-convessa</strong> e può essere scritta come:\n$$\n\\nabla_{\\mathbf{W}}^2 \\mathcal{LL}(\\mathbf{W}) = \\frac{1}{n} \\sum_{i=1}^n \\left( \\text{diag}(\\mathbf{p}_i) - \\mathbf{p}_i \\mathbf{p}_i^\\top \\right) \\otimes \\mathbf{x}_i \\mathbf{x}_i^\\top\n$$\ndove:\n- $\\mathbf{p}_i = [p_{i1}, \\dots, p_{iK}]^\\top$\n- $\\otimes$ è il prodotto di Kronecker\n- $\\text{diag}(\\mathbf{p}_i)$ rappresenta la matrice diagonale di $\\mathbf I_{K \\times K} \\cdot \\mathbf{p}_i$.</p>\n<p><strong>Proprietà</strong>:\n- La matrice $\\text{diag}(\\mathbf{p}_i) - \\mathbf{p}_i \\mathbf{p}_i^\\top$ è semidefinita positiva.\n- La combinazione di matrici semidefinite positive preserva la convessità.</p>\n<h3 id=\"convessita-e-unicita-della-soluzione\"><strong>Convessità e Unicità della Soluzione</strong></h3>\n<h4 id=\"7-convessita-globale\">7. Convessità Globale</h4>\n<p>La cross-entropy multiclasse è <strong>convessa</strong> in $\\mathbf{W}$ perché:\n- La Hessiana è semidefinita positiva.\n- La somma di funzioni convesse è convessa.</p>\n<h4 id=\"8-identificabilita\">8. Identificabilità</h4>\n<p>Il modello è <strong>sovraparametrizzato</strong>: aggiungendo una costante a tutti i pesi $\\mathbf{w}_k$, le probabilità non cambiano. Per rimuovere l&rsquo;ambiguità:\n- Si fissa $\\mathbf{w}_K = \\mathbf{0}$ (classe di riferimento).\n- Si stimano $K-1$ vettori di pesi.</p>\n<h2 id=\"visualizzazione-3d-della-softmax-caso-reale-di-diagnosi-medica\">Visualizzazione 3D della Softmax: Caso Reale di Diagnosi Medica</h2>\n<h3 id=\"contesto-applicativo\">Contesto Applicativo</h3>\n<p>Immaginiamo un sistema di supporto alle decisioni mediche che valuta il rischio di 3 patologie cardiache in base a due parametri vitali:\n1. <strong>Pressione sistolica (z₁)</strong>: Variabile continua (70-200 mmHg)\n2. <strong>Livello di colesterolo (z₂)</strong>: Variabile continua (150-300 mg/dL)</p>\n<p>Le 3 classi di output rappresentano:\n- <strong>Classe 1</strong>: Rischio infarto\n- <strong>Classe 2</strong>: Rischio ictus\n- <strong>Classe 3</strong>: Paziente sano</p>\n<h3 id=\"codice-realta\">Codice-Realtà</h3>\n<h4 id=\"1-preparazione-dati-medici\">1. Preparazione Dati Medici</h4>\n<ul>\n<li><strong>Griglia 3D</strong>: Simula tutte le combinazioni possibili di pressione/colesterolo</li>\n<li><strong>z₀ fisso a 0</strong>: Baseline per pazienti con parametri normali</li>\n<li><strong>Softmax</strong>: Calcola le probabilità relative delle tre condizioni</li>\n</ul>\n<h4 id=\"2-interpretazione-clinica\">2. Interpretazione Clinica</h4>\n<ul>\n<li><strong>Superficie Rossa (Infarto)</strong>: Aumenta con pressione alta + colesterolo elevato</li>\n<li><strong>Superficie Verde (Ictus)</strong>: Predomina per pressione estrema + colesterolo medio</li>\n<li><strong>Superficie Blu (Sano)</strong>: Dominante nella zona parametri normali</li>\n</ul>\n<h3 id=\"dinamiche-chiave\">Dinamiche Chiave</h3>\n<ol>\n<li><strong>Zona Pericolo Estremo</strong> (angolo in alto a destra):</li>\n<li>Pressione &gt; 180 mmHg + Colesterolo &gt; 250 mg/dL</li>\n<li>\n<p>Probabilità infarto ≈80%, ictus ≈15%, sano ≈5%</p>\n</li>\n<li>\n<p><strong>Area Grigia Decisionale</strong> (centro grafico):</p>\n</li>\n<li>Pressione 140-160 mmHg + Colesterolo 200-220 mg/dL</li>\n<li>\n<p>Probabilità simili tra tutte le classi (25-40%)</p>\n</li>\n<li>\n<p><strong>Isola di Salute</strong> (angolo in basso a sinistra):</p>\n</li>\n<li>Pressione &lt; 120 mmHg + Colesterolo &lt; 180 mg/dL</li>\n<li>Probabilità sano &gt;90%</li>\n</ol>\n<h3 id=\"componenti-grafiche-strategiche\">Componenti Grafiche Strategiche</h3>\n<ul>\n<li><strong>Trasparenza</strong>: Mostra sovrapposizioni tra diagnosi concorrenti</li>\n<li><strong>Colori Settoriali</strong>: Allineati alle convenzioni mediche (rosso=emergenza)</li>\n<li><strong>Linee di Contorno</strong>: Indicano le soglie decisionali critiche</li>\n</ul>\n<h3 id=\"utilizzo-pratico\">Utilizzo Pratico</h3>\n<p>I medici possono:\n1. Valutare rapidamente scenari complessi\n2. Identificare soglie di intervento\n3. Spiegare i rischi ai pazienti con visualizzazioni intuitive\n4. Ottimizzare i protocolli di prevenzione</p>\n<blockquote>\n<p><strong>Esempio Decisionale</strong>: Un paziente con:\n- Pressione 160 mmHg (z₁=1.5)\n- Colesterolo 240 mg/dL (z₂=2.0)</p>\n<p>Mostrerà: 45% infarto | 35% ictus | 20% sano<br />\n<strong>Azione</strong>: Combinare terapia ipotensiva + dieta</p>\n</blockquote>\n<details class=\"code-container\">\n<summary>Code</summary>\n<div class=\"code-wrapper\">\n<button class=\"copy-button\" onclick=\"\n                    const code = this.parentElement.querySelector('pre');\n                    if (code) {\n                        navigator.clipboard.writeText(code.innerText);\n                        this.textContent = 'Copied!';\n                        setTimeout(() => this.textContent = 'Copy', 2000);\n                    }\n                \">Copy</button>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">torch</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">numpy</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">np</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">matplotlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">cm</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">mpl_toolkits.mplot3d</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Axes3D</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.patches</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Patch</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">matplotlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">colormaps</span>\n\n<span class=\"c1\"># Configurazione tema medico professionale</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">style</span><span class=\"o\">.</span><span class=\"n\">use</span><span class=\"p\">(</span><span class=\"s1\">&#39;dark_background&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">rcParams</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span>\n    <span class=\"s1\">&#39;font.size&#39;</span><span class=\"p\">:</span> <span class=\"mi\">12</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.titlesize&#39;</span><span class=\"p\">:</span> <span class=\"mi\">16</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.labelcolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;#FFAA00&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;xtick.color&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;#FFFFFF&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;ytick.color&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;#FFFFFF&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;axes.facecolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;#4f4f4e&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;figure.facecolor&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;#4f4f4e&#39;</span>\n<span class=\"p\">})</span>\n\n<span class=\"c1\"># Parametri medici realistici (range clinico)</span>\n<span class=\"n\">sistolica</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"mi\">70</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">,</span> <span class=\"mi\">100</span><span class=\"p\">)</span>     <span class=\"c1\"># mmHg</span>\n<span class=\"n\">colesterolo</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"mi\">150</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"mi\">100</span><span class=\"p\">)</span>  <span class=\"c1\"># mg/dL</span>\n<span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">meshgrid</span><span class=\"p\">(</span><span class=\"n\">sistolica</span><span class=\"p\">,</span> <span class=\"n\">colesterolo</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Normalizzazione per modello (z-score ipotetico)</span>\n<span class=\"n\">z_sis</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">SIS</span> <span class=\"o\">-</span> <span class=\"mi\">135</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"mi\">25</span>  <span class=\"c1\"># Media 135, SD 25</span>\n<span class=\"n\">z_col</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">COL</span> <span class=\"o\">-</span> <span class=\"mi\">225</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"mi\">50</span>   <span class=\"c1\"># Media 225, SD 50</span>\n\n<span class=\"c1\"># Calcolo probabilità patologie</span>\n<span class=\"k\">with</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">no_grad</span><span class=\"p\">():</span>\n    <span class=\"n\">logits</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">stack</span><span class=\"p\">([</span>\n        <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">z_sis</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">0.8</span> <span class=\"o\">+</span> <span class=\"n\">z_col</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">0.5</span><span class=\"p\">),</span>  <span class=\"c1\"># Infarto</span>\n        <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">z_sis</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">1.2</span> <span class=\"o\">+</span> <span class=\"n\">z_col</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">0.3</span><span class=\"p\">),</span>  <span class=\"c1\"># Ictus</span>\n        <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">z_sis</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">0.4</span> <span class=\"o\">-</span> <span class=\"n\">z_col</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mf\">0.2</span><span class=\"p\">)</span>  <span class=\"c1\"># Sano</span>\n    <span class=\"p\">],</span> <span class=\"n\">dim</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">probs</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">functional</span><span class=\"o\">.</span><span class=\"n\">softmax</span><span class=\"p\">(</span><span class=\"n\">logits</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">numpy</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Formattazione per plot 3D</span>\n<span class=\"n\">prob_infarto</span> <span class=\"o\">=</span> <span class=\"n\">probs</span><span class=\"p\">[:,</span> <span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"n\">prob_ictus</span> <span class=\"o\">=</span> <span class=\"n\">probs</span><span class=\"p\">[:,</span> <span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"n\">prob_sano</span> <span class=\"o\">=</span> <span class=\"n\">probs</span><span class=\"p\">[:,</span> <span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Creazione figura</span>\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">,</span> <span class=\"mi\">12</span><span class=\"p\">))</span>\n<span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">add_subplot</span><span class=\"p\">(</span><span class=\"mi\">111</span><span class=\"p\">,</span> <span class=\"n\">projection</span><span class=\"o\">=</span><span class=\"s1\">&#39;3d&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Superfici cliniche</span>\n<span class=\"n\">cmap_emergency</span> <span class=\"o\">=</span> <span class=\"n\">colormaps</span><span class=\"p\">[</span><span class=\"s1\">&#39;Reds&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">reversed</span><span class=\"p\">()</span>\n<span class=\"n\">cmap_stroke</span> <span class=\"o\">=</span> <span class=\"n\">colormaps</span><span class=\"p\">[</span><span class=\"s1\">&#39;Greens&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">reversed</span><span class=\"p\">()</span>\n<span class=\"n\">cmap_sano</span> <span class=\"o\">=</span> <span class=\"n\">colormaps</span><span class=\"p\">[</span><span class=\"s1\">&#39;Purples&#39;</span><span class=\"p\">]</span>  <span class=\"c1\"># Cambiato da Blu a Viola</span>\n\n<span class=\"n\">surf1</span> <span class=\"o\">=</span> <span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">plot_surface</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span><span class=\"p\">,</span> <span class=\"n\">prob_infarto</span><span class=\"p\">,</span>\n                       <span class=\"n\">facecolors</span><span class=\"o\">=</span><span class=\"n\">cmap_emergency</span><span class=\"p\">(</span><span class=\"n\">prob_infarto</span><span class=\"p\">),</span>\n                       <span class=\"n\">alpha</span><span class=\"o\">=</span><span class=\"mf\">0.8</span><span class=\"p\">,</span>\n                       <span class=\"n\">rstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span>\n                       <span class=\"n\">cstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span>\n                       <span class=\"n\">antialiased</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n<span class=\"n\">surf2</span> <span class=\"o\">=</span> <span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">plot_surface</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span><span class=\"p\">,</span> <span class=\"n\">prob_ictus</span><span class=\"p\">,</span>\n                       <span class=\"n\">facecolors</span><span class=\"o\">=</span><span class=\"n\">cmap_stroke</span><span class=\"p\">(</span><span class=\"n\">prob_ictus</span><span class=\"p\">),</span>\n                       <span class=\"n\">alpha</span><span class=\"o\">=</span><span class=\"mf\">0.7</span><span class=\"p\">,</span>\n                       <span class=\"n\">rstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span>\n                       <span class=\"n\">cstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n\n<span class=\"n\">surf3</span> <span class=\"o\">=</span> <span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">plot_surface</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span><span class=\"p\">,</span> <span class=\"n\">prob_sano</span><span class=\"p\">,</span>\n                       <span class=\"n\">facecolors</span><span class=\"o\">=</span><span class=\"n\">cmap_sano</span><span class=\"p\">(</span><span class=\"n\">prob_sano</span><span class=\"p\">),</span>\n                       <span class=\"n\">alpha</span><span class=\"o\">=</span><span class=\"mf\">0.6</span><span class=\"p\">,</span>\n                       <span class=\"n\">rstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span>\n                       <span class=\"n\">cstride</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Etichette cliniche</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Pressione Sistolica (mmHg)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">14</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#FFFFFF&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Colesterolo Totale (mg/dL)&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">14</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#FFFFFF&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_zlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Probabilità Diagnosi&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">14</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#FFFFFF&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_zticks</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linspace</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># Angolo visuale ottimale</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">view_init</span><span class=\"p\">(</span><span class=\"n\">elev</span><span class=\"o\">=</span><span class=\"mi\">38</span><span class=\"p\">,</span> <span class=\"n\">azim</span><span class=\"o\">=-</span><span class=\"mi\">125</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Legenda diagnostica</span>\n<span class=\"n\">legend_elements</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"n\">Patch</span><span class=\"p\">(</span><span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;red&#39;</span><span class=\"p\">,</span> <span class=\"n\">edgecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Rischio Infarto&#39;</span><span class=\"p\">),</span>\n    <span class=\"n\">Patch</span><span class=\"p\">(</span><span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;green&#39;</span><span class=\"p\">,</span> <span class=\"n\">edgecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Rischio Ictus&#39;</span><span class=\"p\">),</span>\n    <span class=\"n\">Patch</span><span class=\"p\">(</span><span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;purple&#39;</span><span class=\"p\">,</span> <span class=\"n\">edgecolor</span><span class=\"o\">=</span><span class=\"s1\">&#39;white&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Paziente Sano&#39;</span><span class=\"p\">)</span>\n<span class=\"p\">]</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">handles</span><span class=\"o\">=</span><span class=\"n\">legend_elements</span><span class=\"p\">,</span> <span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;upper right&#39;</span><span class=\"p\">,</span> <span class=\"n\">fontsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Linee guida cliniche</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">contour</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span><span class=\"p\">,</span> <span class=\"n\">prob_infarto</span><span class=\"p\">,</span> \n          <span class=\"n\">levels</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mf\">0.5</span><span class=\"p\">,</span> <span class=\"mf\">0.7</span><span class=\"p\">],</span> \n          <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"s1\">&#39;#FF0000&#39;</span><span class=\"p\">,</span>\n          <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span>\n          <span class=\"n\">linewidths</span><span class=\"o\">=</span><span class=\"mf\">0.5</span><span class=\"p\">,</span>\n          <span class=\"n\">offset</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">contour</span><span class=\"p\">(</span><span class=\"n\">SIS</span><span class=\"p\">,</span> <span class=\"n\">COL</span><span class=\"p\">,</span> <span class=\"n\">prob_ictus</span><span class=\"p\">,</span> \n          <span class=\"n\">levels</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mf\">0.4</span><span class=\"p\">,</span> <span class=\"mf\">0.6</span><span class=\"p\">],</span> \n          <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"s1\">&#39;#00FF00&#39;</span><span class=\"p\">,</span>\n          <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;-.&#39;</span><span class=\"p\">,</span>\n          <span class=\"n\">linewidths</span><span class=\"o\">=</span><span class=\"mf\">0.5</span><span class=\"p\">,</span>\n          <span class=\"n\">offset</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">(</span><span class=\"n\">pad</span><span class=\"o\">=</span><span class=\"mf\">0.0</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;./images/softmax-example.jpg&#39;</span><span class=\"p\">,</span> \n           <span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"mi\">250</span><span class=\"p\">,</span> \n           <span class=\"n\">bbox_inches</span><span class=\"o\">=</span><span class=\"s1\">&#39;tight&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">pad_inches</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">,</span>  <span class=\"c1\"># Aggiungere questo parametro</span>\n           <span class=\"n\">facecolor</span><span class=\"o\">=</span><span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">get_facecolor</span><span class=\"p\">(),</span>  <span class=\"c1\"># Mantenere il colore di sfondo</span>\n           <span class=\"n\">transparent</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>  <span class=\"c1\"># Disabilitare la trasparenza</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span>\n</code></pre></div>\n</div>\n</details>\n\n<p><img src=\"/images/posts/softmax-example.jpg\" alt=\"Softmax Example\"></p>\n<p><em>Figura 3.0: Esempio di utilizzo della Regressione Logistica con Softmax per la diagnosi di patologie cliniche</em></p>\n<h2 id=\"confronto-con-lanalisi-discriminante-lineare-lda\">Confronto con l&rsquo;Analisi Discriminante Lineare (LDA)</h2>\n<table>\n<thead>\n<tr>\n<th><strong>Caratteristica</strong></th>\n<th><strong>Regressione Logistica</strong></th>\n<th><strong>LDA</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Tipo di Modello</strong></td>\n<td>Discriminativo</td>\n<td>Generativo</td>\n</tr>\n<tr>\n<td><strong>Assunzioni</strong></td>\n<td>Nessuna su $p(\\mathbf{x} \\mid y)$</td>\n<td>Features ~ Gaussiane con stessa covarianza</td>\n</tr>\n<tr>\n<td><strong>Stima Parametri</strong></td>\n<td>Massimizzazione della verosimiglianza</td>\n<td>Massimizzazione joint likelihood</td>\n</tr>\n<tr>\n<td><strong>Robustezza</strong></td>\n<td>Maggiore in assenza di normalità delle features</td>\n<td>Sensibile a violazioni delle assunzioni</td>\n</tr>\n<tr>\n<td><strong>Interpretazione</strong></td>\n<td>Coefficienti come log-odds ratio</td>\n<td>Coefficienti legati a media e covarianza</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"aspetti-pratici\"><strong>Aspetti Pratici</strong></h2>\n<h3 id=\"regolarizzazione\">Regolarizzazione</h3>\n<p>Per evitare overfitting, si aggiungono termini di penalità alla loss:\n- <strong>L1 (Lasso)</strong>: $\\lambda \\|\\mathbf{w}\\|_1$ → Sparsità (selezione features).\n- <strong>L2 (Ridge)</strong>: $\\lambda \\|\\mathbf{w}\\|_2^2$ → Contrazione coefficienti.</p>\n<p>Esempio con regolarizzazione L2:\n$$\n\\ell_{\\text{reg}}(\\mathbf{w}) = \\ell(\\mathbf{w}) + \\lambda \\sum_{j=1}^n w_j^2\n$$</p>\n<h3 id=\"soglie-di-decisione-non-standard\">Soglie di Decisione Non Standard</h3>\n<p>La soglia 0.5 è ottimale solo se:\n- Costi di falsi positivi/negativi sono bilanciati.\n- La distribuzione delle classi è uniforme.</p>\n<p>In scenari sbilanciati, si può ottimizzare la soglia massimizzando l&rsquo;<strong>F1-score</strong> o minimizzando costi specifici.</p>\n<h2 id=\"esempio-interpretazione-coefficienti\"><strong>Esempio: Interpretazione Coefficienti</strong></h2>\n<p>Supponiamo un modello con:\n- <strong>Feature</strong>: Età ($\\mathbf{x}_1$), Reddito ($\\mathbf{x}_2$).\n- <strong>Coefficiente stimato</strong>: $\\mathbf{w} = [0.8, -0.2]$.</p>\n<p><strong>Interpretazione</strong>:\n- <strong>Età</strong>: Un aumento di 1 anno moltiplica gli odds ratio per $e^{0.8} ≈ 2.23$ (favorevole alla classe positiva).\n- <strong>Reddito</strong>: Un aumento di 1 unità moltiplica gli odds ratio per $e^{-0.2} ≈ 0.82$ (sfavorevole).</p>\n<h2 id=\"limiti-della-regressione-logistica\"><strong>Limiti della Regressione Logistica</strong></h2>\n<ol>\n<li><strong>Linearità nei Confini</strong>: Assume che il logit sia lineare nelle features → Non cattura interazioni complesse.</li>\n<li><strong>Sensibilità a Correlazioni</strong>: Features altamente correlate possono destabilizzare i coefficienti.</li>\n<li><strong>Classi Separabili</strong>: Se le classi sono linearmente separabili, i coefficienti divergono ($\\|\\mathbf{w}\\| \\to \\infty$).</li>\n</ol>\n<p>Per superare questi limiti, si possono introdurre:\n- <strong>Feature Polinomiali</strong>: $\\mathbf{x}_1^2, \\mathbf{x}_1 \\mathbf{x}_2$.\n- <strong>Kernel Methods</strong>: Mappare implicitamente in spazi ad alta dimensionalità.</p>"
}